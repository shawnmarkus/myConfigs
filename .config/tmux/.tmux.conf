# Set filetype and disable wrapping when editing this file in Vim
# vim: set ft=tmux tw=0 nowrap:

# Set PATH for tmux sessions (ensures Homebrew binaries are available)
set-environment -g PATH "/opt/homebrew/bin:/bin:/usr/bin"

# Start window numbering from 1 instead of 0
set -g base-index 1

# Start pane numbering from 1 instead of 0
setw -g pane-base-index 1

# Enable focus events so apps (like Vim/Neovim) can detect focus changes
set -g focus-events on

# Remove ESC key delay (improves Vim/Neovim responsiveness)
set -sg escape-time 0

# Update status bar every 5 seconds (reduces CPU usage)
set-option -g status-interval 5

# Enable mouse support for pane selection, resizing, and scrolling
set -g mouse on

# Detect whether the current pane is running Vim or Neovim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+/)?g?(view|n?vim?x?)(diff)?$'"

# Ctrl-h: move left in Vim splits, otherwise move to left tmux pane
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'

# Ctrl-j: move down in Vim splits, otherwise move to lower tmux pane
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'

# Ctrl-k: move up in Vim splits, otherwise move to upper tmux pane
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'

# Ctrl-l: move right in Vim splits, otherwise move to right tmux pane
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# Ctrl-\: switch to last pane or Vim split
bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'

# Use Vim-style keys in copy mode
setw -g mode-keys vi

# Ctrl-h: move left pane while in copy mode
bind-key -T copy-mode-vi 'C-h' select-pane -L

# Ctrl-j: move down pane while in copy mode
bind-key -T copy-mode-vi 'C-j' select-pane -D

# Ctrl-k: move up pane while in copy mode
bind-key -T copy-mode-vi 'C-k' select-pane -U

# Ctrl-l: move right pane while in copy mode
bind-key -T copy-mode-vi 'C-l' select-pane -R

# Ctrl-\: switch to last pane while in copy mode
bind-key -T copy-mode-vi 'C-\' select-pane -l

# Alt+1: switch to window 1 or create it if missing
bind -n M-1 run-shell 'tmux select-window -t 1 || tmux new-window -t 1'

# Alt+2: switch to window 2 or create it if missing
bind -n M-2 run-shell 'tmux select-window -t 2 || tmux new-window -t 2'

# Alt+3: switch to window 3 or create it if missing
bind -n M-3 run-shell 'tmux select-window -t 3 || tmux new-window -t 3'

# Alt+4: switch to window 4 or create it if missing
bind -n M-4 run-shell 'tmux select-window -t 4 || tmux new-window -t 4'

# Alt+5: switch to window 5 or create it if missing
bind -n M-5 run-shell 'tmux select-window -t 5 || tmux new-window -t 5'

# Alt+6: switch to window 6 or create it if missing
bind -n M-6 run-shell 'tmux select-window -t 6 || tmux new-window -t 6'

# Alt+7: switch to window 7 or create it if missing
bind -n M-7 run-shell 'tmux select-window -t 7 || tmux new-window -t 7'

# Alt+8: switch to window 8 or create it if missing
bind -n M-8 run-shell 'tmux select-window -t 8 || tmux new-window -t 8'

# Alt+9: switch to window 9 or create it if missing
bind -n M-9 run-shell 'tmux select-window -t 9 || tmux new-window -t 9'

# Use 256-color terminal support for better color accuracy
set-option default-terminal "tmux-256color"

# Mouse wheel scroll up: enter copy mode and scroll
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" \
  "send-keys -M" \
  "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"

# Mouse wheel scroll down: pass scrolling to pane
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Ctrl + mouse scroll up: enter copy mode and scroll
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M

# Ctrl + scroll up in copy mode (Vim keys): half-page up
bind -T copy-mode-vi    C-WheelUpPane   send-keys -X halfpage-up

# Ctrl + scroll down in copy mode (Vim keys): half-page down
bind -T copy-mode-vi    C-WheelDownPane send-keys -X halfpage-down

# Same half-page scrolling for Emacs copy mode
bind -T copy-mode-emacs C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-emacs C-WheelDownPane send-keys -X halfpage-down

# Unbind Enter in copy mode (Vim style)
unbind -T copy-mode-vi Enter

# Enter: copy selection and send it to system clipboard (macOS pbcopy)
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# Copy selection automatically when mouse drag ends
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Alt+H: resize pane left
bind -n M-H resize-pane -L 5

# Alt+L: resize pane right
bind -n M-L resize-pane -R 5

# Alt+J: resize pane down
bind -n M-J resize-pane -D 5

# Alt+K: resize pane up
bind -n M-K resize-pane -U 5

# Alt+l: split pane horizontally and keep current directory
bind -n M-l split-window -h -c "#{pane_current_path}"

# Alt+j: split pane vertically and keep current directory
bind -n M-j split-window -v -c "#{pane_current_path}"

# Alt+Shift+C: close pane if multiple panes exist, else close window
bind -n M-C if-shell '[ "$(tmux display-message -p "#{window_panes}")" -gt 1 ]' \
  'kill-pane' \
  'kill-window'

# Align window list to the left
set -g status-justify "left"

# Enable status bar
set -g status "on"

# Remove styling from left status section
set -g status-left-style "none"

# Remove styling from right status section
set -g status-right-style "none"

# Highlight active pane border
set -g pane-active-border-style "fg=#a89984"

# Set status bar background color
set -g status-style "none,bg=#282828"

# Style tmux messages (like confirmations)
set -g message-style "fg=#ddc7a1,bg=#504945"

# Style inactive pane borders
set -g pane-border-style "fg=#504945"

# Limit length of right status area
set -g status-right-length "100"

# Limit length of left status area
set -g status-left-length "100"

# Disable activity highlight styling
setw -g window-status-activity-style "none"

# Separator between windows in status bar
setw -g window-status-separator " | "

# Style inactive window names
setw -g window-status-style "none,fg=#ddc7a1,bg=#282828"

# Show session name on left side of status bar
set -g status-left " [#S] "

# Keep right side of status bar empty
set -g status-right ""
